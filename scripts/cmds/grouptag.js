module.exports = {
	config: {
		name: "ุฌุฑูุจ_ุชุงุบ",
		aliases: ["ุฌุฑูุจ.ุชุงุบ", "ุชุงุบ_ุฌุฑูุจ"],
		version: "1.5",
		author: "Sifo Anter",
		countDown: 5,
		role: 0,
		description: {
			ar: "ุฅุฏุงุฑุฉ ูุฌููุนุงุช ุงูุชุงุบ ุฏุงุฎู ุงูุฏุฑุฏุดุฉ."
		},
		category: "ุงููุนูููุงุช",
		guide: {
			ar: 
				"{pn} ุฅุถุงูุฉ <ุงุณู_ุงููุฌููุนุฉ> <@ุชุงุบ_ุงูุฃุนุถุงุก>: ูุฅูุดุงุก ูุฌููุนุฉ ุฌุฏูุฏุฉ ุฃู ุฅุถุงูุฉ ุฃุนุถุงุก ุฅูู ูุฌููุนุฉ ููุฌูุฏุฉ.\n" +
				"ูุซุงู:\n" +
				"  {pn} ุฅุถุงูุฉ ุงููุฑูู1 @ุนุถู1 @ุนุถู2\n\n" +
				
				"{pn} ุญุฐู <ุงุณู_ุงููุฌููุนุฉ> <@ุชุงุบ_ุงูุฃุนุถุงุก>: ูุญุฐู ุฃุนุถุงุก ูุนูููู ูู ุงููุฌููุนุฉ.\n" +
				"ูุซุงู:\n" +
				"  {pn} ุญุฐู ุงููุฑูู1 @ุนุถู1 @ุนุถู2\n\n" +

				"{pn} ุฅุฒุงูุฉ <ุงุณู_ุงููุฌููุนุฉ>: ูุญุฐู ุงููุฌููุนุฉ ุจุงููุงูู.\n" +
				"ูุซุงู:\n" +
				"  {pn} ุฅุฒุงูุฉ ุงููุฑูู1\n\n" +

				"{pn} ุชุงุบ <ุงุณู_ุงููุฌููุนุฉ>: ููุฅุดุงุฑุฉ ุฅูู ุฌููุน ุฃุนุถุงุก ุงููุฌููุนุฉ.\n\n" +

				"{pn} ุฅุนุงุฏุฉ_ุชุณููุฉ <ุงูุงุณู_ุงููุฏูู> | <ุงูุงุณู_ุงูุฌุฏูุฏ>: ูุชุบููุฑ ุงุณู ุงููุฌููุนุฉ.\n\n" +

				"{pn} [ูุงุฆูุฉ | ุงููู]: ูุนุฑุถ ุฌููุน ุงููุฌููุนุงุช ุงููุณุฌูุฉ ูู ุงูุฏุฑุฏุดุฉ.\n\n" +

				"{pn} ูุนูููุงุช <ุงุณู_ุงููุฌููุนุฉ>: ูุนุฑุถ ูุนูููุงุช ูุฌููุนุฉ ูุนููุฉ."
		}
	},

	langs: {
		ar: {
			noGroupTagName: "โ | ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงููุฌููุนุฉ.",
			noMention: "โ | ูู ุชูู ุจุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุนุถู ูุฅุถุงูุชู ุฅูู ุงููุฌููุนุฉ.",
			addedSuccess: "โ | ุชูุช ุฅุถุงูุฉ ุงูุฃุนุถุงุก ุงูุชุงููุฉ ุฃุณูุงุคูู ุฅูู ุงููุฌููุนุฉ \"%1\":\n%2",
			addedSuccess2: "โ | ุชู ุฅูุดุงุก ุงููุฌููุนุฉ \"%1\" ูุฅุถุงูุฉ ุงูุฃุนุถุงุก:\n%2",
			existedInGroupTag: "โ๏ธ | ุงูุฃุนุถุงุก ุงูุชุงูููู ููุฌูุฏูู ุจุงููุนู ูู ุงููุฌููุนุฉ \"%2\":\n%1",
			notExistedInGroupTag: "โ๏ธ | ุงูุฃุนุถุงุก ุงูุชุงูููู ุบูุฑ ููุฌูุฏูู ูู ุงููุฌููุนุฉ \"%2\":\n%1",
			noExistedGroupTag: "โ | ุงููุฌููุนุฉ \"%1\" ุบูุฑ ููุฌูุฏุฉ ูู ูุฐู ุงูุฏุฑุฏุดุฉ.",
			noExistedGroupTag2: "โ | ูุง ุชูุฌุฏ ุฃู ูุฌููุนุฉ ูุณุฌูุฉ ูู ูุฐู ุงูุฏุฑุฏุดุฉ.",
			noMentionDel: "โ | ูุฑุฌู ุงูุฅุดุงุฑุฉ ุฅูู ุงูุฃุนุถุงุก ุงูุฐูู ุชุฑูุฏ ุญุฐููู ูู ุงููุฌููุนุฉ \"%1\".",
			deletedSuccess: "โ | ุชู ุญุฐู ุงูุฃุนุถุงุก ุงูุชุงููุฉ ุฃุณูุงุคูู ูู ุงููุฌููุนุฉ \"%2\":\n%1",
			deletedSuccess2: "โ | ุชู ุญุฐู ุงููุฌููุนุฉ \"%1\" ุจุงููุงูู.",
			tagged: "๐ข | ุชูุช ุงูุฅุดุงุฑุฉ ุฅูู ุฃุนุถุงุก ุงููุฌููุนุฉ \"%1\":\n%2",
			noGroupTagName2: "โ | ูุฑุฌู ุฅุฏุฎุงู ุงูุงุณู ุงููุฏูู ูููุฌููุนุฉ ูุงูุงุณู ุงูุฌุฏูุฏ ููุตูููู ุจู \"|\".",
			renamedSuccess: "โ | ุชู ุชุบููุฑ ุงุณู ุงููุฌููุนุฉ ูู \"%1\" ุฅูู \"%2\".",
			infoGroupTag: "๐ | ุงุณู ุงููุฌููุนุฉ: %1\n๐ฅ | ุนุฏุฏ ุงูุฃุนุถุงุก: %2\n๐จโ๐ฉโ๐งโ๐ฆ | ูุงุฆูุฉ ุงูุฃุนุถุงุก:\n %3"
		}
	},

	onStart: async function ({ message, event, args, threadsData, getLang }) {
		const { threadID, mentions } = event;
		for (const uid in mentions)
			mentions[uid] = mentions[uid].replace("@", "");
		const groupTags = await threadsData.get(threadID, "data.groupTags", []);

		switch (args[0]) {
			case "ุฅุถุงูุฉ": {
				const mentionsID = Object.keys(event.mentions);
				const content = args.slice(1).join(" ");
				const groupTagName = content.split("@")[0].trim();

				if (!groupTagName) return message.reply(getLang("noGroupTagName"));
				if (mentionsID.length === 0) return message.reply(getLang("noMention"));

				const oldGroupTag = groupTags.find(tag => tag.name.toLowerCase() === groupTagName.toLowerCase());
				if (oldGroupTag) {
					const usersIDExist = [];
					const usersIDNotExist = [];
					for (const uid of mentionsID) {
						if (oldGroupTag.users[uid]) {
							usersIDExist.push(uid);
						} else {
							oldGroupTag.users[uid] = mentions[uid];
							usersIDNotExist.push(uid);
						}
					}
					await threadsData.set(threadID, groupTags, "data.groupTags");

					let msg = "";
					if (usersIDNotExist.length > 0)
						msg += getLang("addedSuccess", oldGroupTag.name, usersIDNotExist.map(uid => mentions[uid]).join("\n")) + "\n";
					if (usersIDExist.length > 0)
						msg += getLang("existedInGroupTag", usersIDExist.map(uid => mentions[uid]).join("\n"), oldGroupTag.name);
					message.reply(msg);
				} else {
					const newGroupTag = { name: groupTagName, users: mentions };
					groupTags.push(newGroupTag);
					await threadsData.set(threadID, groupTags, "data.groupTags");
					message.reply(getLang("addedSuccess2", groupTagName, Object.values(mentions).join("\n")));
				}
				break;
			}

			case "ูุงุฆูุฉ":
			case "ุงููู": {
				const msg = groupTags.map(group => `๐ ${group.name}:\n ${Object.values(group.users).join("\n ")}`).join("\n\n");
				message.reply(msg || getLang("noExistedGroupTag2"));
				break;
			}

			case "ูุนูููุงุช": {
				const groupTagName = args.slice(1).join(" ");
				if (!groupTagName) return message.reply(getLang("noGroupTagName"));
				const groupTag = groupTags.find(tag => tag.name.toLowerCase() === groupTagName.toLowerCase());
				if (!groupTag) return message.reply(getLang("noExistedGroupTag", groupTagName));
				return message.reply(getLang("infoGroupTag", groupTag.name, Object.keys(groupTag.users).length, Object.values(groupTag.users).join("\n")));
			}

			case "ุฅุฒุงูุฉ": {
				const groupTagName = args.slice(1).join(" ").trim();
				const index = groupTags.findIndex(group => group.name.toLowerCase() === groupTagName.toLowerCase());
				if (index === -1) return message.reply(getLang("noExistedGroupTag", groupTagName));
				groupTags.splice(index, 1);
				await threadsData.set(threadID, groupTags, "data.groupTags");
				message.reply(getLang("deletedSuccess2", groupTagName));
				break;
			}

			case "ุฅุนุงุฏุฉ_ุชุณููุฉ": {
				const [oldName, newName] = args.slice(1).join(" ").split("|").map(str => str.trim());
				if (!oldName || !newName) return message.reply(getLang("noGroupTagName2"));
				const oldGroupTag = groupTags.find(tag => tag.name.toLowerCase() === oldName.toLowerCase());
				if (!oldGroupTag) return message.reply(getLang("noExistedGroupTag", oldName));
				oldGroupTag.name = newName;
				await threadsData.set(threadID, groupTags, "data.groupTags");
				message.reply(getLang("renamedSuccess", oldName, newName));
				break;
			}

			case "ุชุงุบ": {
				const groupTagName = args.slice(1).join(" ").trim();
				if (!groupTagName) return message.reply(getLang("noGroupTagName"));
				const groupTag = groupTags.find(tag => tag.name.toLowerCase() === groupTagName.toLowerCase());
				if (!groupTag) return message.reply(getLang("noExistedGroupTag", groupTagName));
				const mentions = Object.keys(groupTag.users).map(uid => ({ id: uid, tag: groupTag.users[uid] }));
				message.reply({ body: getLang("tagged", groupTag.name, Object.values(groupTag.users).join("\n")), mentions });
				break;
			}
		}
	}
};